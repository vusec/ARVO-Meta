INFO: Running with entropic power schedule (0xFF, 100).
INFO: Seed: 2017405795
INFO: Loaded 1 modules   (57484 inline 8-bit counters): 57484 [0xf3ab00, 0xf48b8c), 
INFO: Loaded 1 PC tables (57484 PCs): 57484 [0xd35210,0xe15ad0), 
/out/ffmpeg_AV_CODEC_ID_TIFF_fuzzer: Running 1 inputs 1 time(s) each.
Running: /tmp/poc
=================================================================
==7==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x73a863558040 at pc 0x0000007ea6b1 bp 0x7fff6617a2a0 sp 0x7fff6617a298
WRITE of size 1 at 0x73a863558040 thread T0
SCARINESS: 41 (1-byte-write-heap-buffer-overflow-far-from-bounds)
    #0 0x7ea6b0 in ls_decode_line /src/ffmpeg/libavcodec/jpeglsdec.c:266:21
    #1 0x7e6382 in ff_jpegls_decode_picture /src/ffmpeg/libavcodec/jpeglsdec.c:448:23
    #2 0x5b3f95 in ff_mjpeg_decode_sos /src/ffmpeg/libavcodec/mjpegdec.c:1760:24
    #3 0x5c3b2c in ff_mjpeg_receive_frame /src/ffmpeg/libavcodec/mjpegdec.c:2613:24
    #4 0x596904 in decode_receive_frame_internal /src/ffmpeg/libavcodec/decode.c:536:15
    #5 0x5966b2 in avcodec_send_packet /src/ffmpeg/libavcodec/decode.c:607:15
    #6 0x5f458a in dng_decode_jpeg /src/ffmpeg/libavcodec/tiff.c:658:11
    #7 0x5f73e5 in dng_decode_strip /src/ffmpeg/libavcodec/tiff.c:735:12
    #8 0x5f2be2 in tiff_unpack_strip /src/ffmpeg/libavcodec/tiff.c:859:20
    #9 0x5e7ac9 in decode_frame /src/ffmpeg/libavcodec/tiff.c:2004:24
    #10 0x596e75 in decode_simple_internal /src/ffmpeg/libavcodec/decode.c:325:15
    #11 0x596e75 in decode_simple_receive_frame /src/ffmpeg/libavcodec/decode.c:520:15
    #12 0x596e75 in decode_receive_frame_internal /src/ffmpeg/libavcodec/decode.c:540:15
    #13 0x5966b2 in avcodec_send_packet /src/ffmpeg/libavcodec/decode.c:607:15
    #14 0x582d8f in LLVMFuzzerTestOneInput /src/ffmpeg/tools/target_dec_fuzzer.c:395:25
    #15 0x477993 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) cxa_noexception.cpp
    #16 0x4635d2 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:324:6
    #17 0x468e2c in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) cxa_noexception.cpp
    #18 0x491c32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10
    #19 0x73a864641082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082)
    #20 0x441d8d in _start (/out/ffmpeg_AV_CODEC_ID_TIFF_fuzzer+0x441d8d)

DEDUP_TOKEN: ls_decode_line--ff_jpegls_decode_picture--ff_mjpeg_decode_sos
0x73a863558040 is located 1984 bytes to the left of 264271-byte region [0x73a863558800,0x73a86359904f)
allocated by thread T0 here:
    #0 0x548287 in posix_memalign /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:210:3
    #1 0xb60f30 in av_malloc /src/ffmpeg/libavutil/mem.c:104:9
    #2 0xb2f062 in av_buffer_alloc /src/ffmpeg/libavutil/buffer.c:82:12
    #3 0xb2f329 in av_buffer_allocz /src/ffmpeg/libavutil/buffer.c:95:24
    #4 0xb316c9 in pool_alloc_buffer /src/ffmpeg/libavutil/buffer.c:366:26
    #5 0xb316c9 in av_buffer_pool_get /src/ffmpeg/libavutil/buffer.c:404:15
    #6 0x59fc60 in video_get_buffer /src/ffmpeg/libavcodec/decode.c:1433:23
    #7 0x59fc60 in avcodec_default_get_buffer2 /src/ffmpeg/libavcodec/decode.c:1469:16
    #8 0x5a1f97 in ff_get_buffer /src/ffmpeg/libavcodec/decode.c:1696:11
    #9 0x5d8b07 in thread_get_buffer_internal /src/ffmpeg/libavcodec/pthread_frame.c:959:16
    #10 0x5d8b07 in ff_thread_get_buffer /src/ffmpeg/libavcodec/pthread_frame.c:1051:15
    #11 0x5ec0db in init_image /src/ffmpeg/libavcodec/tiff.c:1196:16
    #12 0x5e6eec in decode_frame /src/ffmpeg/libavcodec/tiff.c:1917:16
    #13 0x596e75 in decode_simple_internal /src/ffmpeg/libavcodec/decode.c:325:15
    #14 0x596e75 in decode_simple_receive_frame /src/ffmpeg/libavcodec/decode.c:520:15
    #15 0x596e75 in decode_receive_frame_internal /src/ffmpeg/libavcodec/decode.c:540:15
    #16 0x5966b2 in avcodec_send_packet /src/ffmpeg/libavcodec/decode.c:607:15
    #17 0x582d8f in LLVMFuzzerTestOneInput /src/ffmpeg/tools/target_dec_fuzzer.c:395:25
    #18 0x477993 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) cxa_noexception.cpp
    #19 0x4635d2 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:324:6
    #20 0x468e2c in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) cxa_noexception.cpp
    #21 0x491c32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10
    #22 0x73a864641082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082)

DEDUP_TOKEN: posix_memalign--av_malloc--av_buffer_alloc
SUMMARY: AddressSanitizer: heap-buffer-overflow /src/ffmpeg/libavcodec/jpeglsdec.c:266:21 in ls_decode_line
Shadow bytes around the buggy address:
  0x0e758c6a2fb0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0e758c6a2fc0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0e758c6a2fd0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0e758c6a2fe0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0e758c6a2ff0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
=>0x0e758c6a3000: fa fa fa fa fa fa fa fa[fa]fa fa fa fa fa fa fa
  0x0e758c6a3010: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0e758c6a3020: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0e758c6a3030: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0e758c6a3040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0e758c6a3050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07 
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==7==ABORTING
